<views xmlns="http://software.in2p3.fr/lavoisier/application.xsd">
    <!-- 
        Project : argo-eosc 
        File    : commons.xml
        Created by cyril on 2018/03/29 
    -->

    <view name="reportDetails-eudat" authenticators="eudat">
        <connector type="XMLConnector">
            <parameter name="content" eval="view('reportDetails',arguments())"/>
        </connector>

        <renderers>
            <renderer type="HTMLRenderer">
                <parameter name="template">app/html/report-ar/report_details.html</parameter>
            </renderer>
        </renderers>
    </view>

    <view name="reportDetails">
        <argument name="report"/>
        <argument name="tenant"/>
        <connector type="XMLConnector">
            <parameter name="content" eval="view('reportDetailsRaw')"/>
        </connector>

        <processors>
            <element in="root">
                <attribute-create out="report">$report</attribute-create>
                <attribute-create out="tenant">$tenant</attribute-create>
                <attribute-create out="view">'reportDetails'</attribute-create>

                <element in="report" if="@tenant=$tenant and @report=$report">
                    <attribute-create out="active">true()</attribute-create>
                </element>

                <element in="report">
                    <element-ignore if="../@tenant!=$tenant or ../@report!=$report"/>
                </element>

            </element>
        </processors>

        <renderers>
            <renderer type="HTMLRenderer">
                <parameter name="template">app/html/report-ar/report_details.html</parameter>
            </renderer>
        </renderers>

    </view>

    <view name="reportTopology">

        <argument name="tenant"/>
        <argument name="report"/>

        <variable name="api-key" eval="view('tenants')/tenants/tenant[name/text()=upper-case($tenant)]/api_key/text()"/>
        <variable name="url" eval="concat(property('api.topology'),'/',$report)"/>

        <connector type="HTTPConnector">
            <parameter name="url" eval="$url"/>
            <parameter name="force-redirect">true</parameter>
            <parameter name="header">
                <entry key="x-api-key" eval="$api-key"/>
                <entry key="Accept">application/json</entry>
            </parameter>
        </connector>
        <serializer type="JSONStreamSerializer"/>



        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="contentType">text/xml</parameter>
            </renderer>
        </renderers>
    </view>


    <view name="dashboard-filter">

        <argument name="report">Critical</argument>
        <argument name="tenant">egi</argument>
        <argument name="entity">_entity_</argument>
        <argument name="status">_status_</argument>


        <connector type="XMLConnector">
            <parameter name="content" eval="new_element('root')"/>
        </connector>

        <processors>


            <element in="root">
                <attribute-create out="report">$report</attribute-create>
                <attribute-create out="tenant">$tenant</attribute-create>
                <attribute-create out="details">'level1'</attribute-create>
                <attribute-create out="group">$entity</attribute-create>


                <element-create>view('tenants.reports')/tenants/tenant[@id=$tenant]/report</element-create>


            </element>

            <element in="root">
                <attribute-create out="topology">
                    ../report[@tenant=../@tenant][upper-case(@report)=upper-case(../@report)]/@topology2
                </attribute-create>


                <element-create>
                    view('api-status-last',entry('report',$report)|entry('tenant',$tenant)|entry('topology',../report[@tenant=../@tenant][upper-case(@report)=upper-case(../@report)]/@topology2)|entry('entity',$entity)|entry('status',$status))
                </element-create>
                <element-create>
                    view('report-ar',entry('report',$report)|entry('tenant',$tenant)|entry('topology',../report[@tenant=../@tenant][upper-case(@report)=upper-case(../@report)]/@topology2)|entry('entity',$entity))
                </element-create>


            </element>

            <element in="root" out="error" if="error" attributes="@*">
                <element-ignore in="error">
                    <element/>
                </element-ignore>
            </element>


        </processors>


        <renderers>
            <renderer type="HTMLRenderer">
                <parameter name="template">app/html/dashboard/dashboard.html</parameter>
            </renderer>
        </renderers>

    </view>

    <view name="dashboard-eudat" authenticators="eudat">

        <connector type="XMLConnector">
            <parameter name="content" eval="view('dashboard',arguments())"/>
        </connector>
        <renderers>
            <renderer type="HTMLRenderer">
                <parameter name="template">app/html/dashboard/dashboard.html</parameter>
            </renderer>
        </renderers>
    </view>

    <view name="dashboard">

        <argument name="report">Critical</argument>
        <argument name="tenant">egi</argument>
        <argument name="scope">_scope_</argument>
        <argument name="status">_status_</argument>


        <connector type="XMLConnector">
            <parameter name="content" eval="new_element('root')"/>
        </connector>

        <processors>


            <element in="root">
                <attribute-create out="report">$report</attribute-create>
                <attribute-create out="tenant">$tenant</attribute-create>
                <attribute-create out="details">'level0'</attribute-create>
                <attribute-create out="view">'dashboard'</attribute-create>

                <element-create>view('tenants.reports')/tenants/tenant[@name=upper-case($tenant)]/report</element-create>
            </element>

            <element in="root" if="$scope='_scope_'">
                <attribute-create out="topology">
                    ../report[@tenant=../@tenant][upper-case(@report)=upper-case(../@report)]/@topology2
                </attribute-create>

                <element-create>view('downtimes',entry('tenant',$tenant)|entry('report',$report))</element-create>


                <element-create>
                    view('api-status-last',entry('report',$report)|entry('tenant',$tenant)|entry('topology',../report[@tenant=../@tenant][upper-case(@report)=upper-case(../@report)]/@topology2)|entry('status',$status))
                </element-create>

                <element-create>
                    view('report-ar',entry('report',$report)|entry('tenant',$tenant)|entry('topology',../report[@tenant=../@tenant][upper-case(@report)=upper-case(../@report)]/@topology1))
                </element-create>

            </element>


            <element in="root" out="error" if="error" attributes="@*">
                <element-ignore in="error">
                    <element/>
                </element-ignore>
            </element>


        </processors>


        <renderers>
            <renderer type="HTMLRenderer">
                <parameter name="template">app/html/dashboard/dashboard.html</parameter>
            </renderer>
        </renderers>
    </view>

    <view name="custom-eudat" authenticators="eudat">
        <argument name="report">Operational-Services</argument>
        <argument name="tenant">eudat</argument>

        <connector type="XMLConnector">
            <parameter name="content" eval="new_element('root')"/>
        </connector>

        <processors>

            <element in="root">
                <attribute-create out="report">$report</attribute-create>
                <attribute-create out="tenant">$tenant</attribute-create>
                <element-create>view('tenants.reports')/tenants/tenant/report</element-create>

            </element>
        </processors>

        <renderers>
            <renderer type="HTMLRenderer">
                <parameter name="template">app/html/custom.html</parameter>
            </renderer>
        </renderers>

    </view>

    <view name="custom">

        <argument name="report">Critical</argument>
        <argument name="tenant">egi</argument>


        <connector type="XMLConnector">
            <parameter name="content" eval="new_element('root')"/>
        </connector>

        <processors>

            <element in="root">
                <attribute-create out="report">$report</attribute-create>
                <attribute-create out="tenant">$tenant</attribute-create>
                <attribute-create out="view">'custom'</attribute-create>
                <element-create>view('tenants.reports')/tenants/tenant/report</element-create>

            </element>
        </processors>

        <renderers>
            <renderer type="HTMLRenderer">
                <parameter name="template">app/html/custom.html</parameter>
            </renderer>
        </renderers>

    </view>







    <view name="StateColor">


        <connector type="XMLConnector">
            <parameter name="content">
                <entry key="OK">#28a745</entry>
                <entry key="WARNING">#ffc107</entry>
                <entry key="UNKNOWN">#d3e3ef</entry>
                <entry key="MISSING">#3b7fbf</entry>
                <entry key="CRITICAL">#dc3545</entry>
                <entry key="DOWNTIME">#17a2b8</entry>
            </parameter>

        </connector>
    </view>


    <view name="policies">
        <argument name="report"/>
        <argument name="tenant"/>
        <connector type="XMLConnector">
            <parameter name="content" eval="new_element('root',new_attribute('tenant',$tenant)|new_attribute('report',$report))"/>
        </connector>

        <processors>
            <element in="root">
                <attribute-create out="view">'policies'</attribute-create>

                <element-create>view('tenants.reports')/tenants/tenant/report</element-create>
            </element>
        </processors>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="template">app/html/policies.html</parameter>
            </renderer>
            <renderer type="HTMLRenderer">
                <parameter name="template">app/html/policies.html</parameter>
            </renderer>
        </renderers>

    </view>

    <view name="cookie_policies">
        <argument name="report"/>
        <argument name="tenant"/>
        <connector type="XMLConnector">
            <parameter name="content" eval="new_element('root',new_attribute('tenant',$tenant)|new_attribute('report',$report))"/>
        </connector>

        <processors>
            <element in="root">
                <attribute-create out="view">'cookie_policies'</attribute-create>

                <element-create>view('tenants.reports')/tenants/tenant/report</element-create>
            </element>
        </processors>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="template">app/html/cookie_policies.html</parameter>
            </renderer>
            <renderer type="HTMLRenderer">
                <parameter name="template">app/html/cookie_policies.html</parameter>
            </renderer>
        </renderers>

    </view>

    <view name="termsofUse">
        <argument name="report"/>
        <argument name="tenant"/>
        <connector type="XMLConnector">
            <parameter name="content" eval="new_element('root',new_attribute('tenant',$tenant)|new_attribute('report',$report))"/>
        </connector>

        <processors>
            <element in="root">
                <attribute-create out="view">'termsofUse'</attribute-create>
                <element-create>view('tenants.reports')/tenants/tenant/report</element-create>
            </element>
        </processors>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="template">app/html/ToU.html</parameter>
            </renderer>
            <renderer type="HTMLRenderer">
                <parameter name="template">app/html/ToU.html</parameter>
            </renderer>
        </renderers>

    </view>


    <view name="documentation">
        <argument name="tenant"/>
        <argument name="report"/>
        <connector type="XMLConnector">
            <parameter name="content" eval="new_element('root',new_attribute('tenant',$tenant)|new_attribute('report',$report))"/>
        </connector>

        <processors>
            <element in="root">
                <attribute-create out="view">'documentation'</attribute-create>
                <element-create>view('tenants.reports')/tenants/tenant/report</element-create>
            </element>
        </processors>

        <renderers>
            <renderer type="DefaultRenderer">
                <parameter name="template">app/html/documentation/documentation.html</parameter>
            </renderer>
            <renderer type="HTMLRenderer">
                <parameter name="template">app/html/documentation/documentation.html</parameter>
            </renderer>
        </renderers>

    </view>





</views>