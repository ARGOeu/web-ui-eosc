<!DOCTYPE html>
<html lang="en" xmlns:tpl="http://software.in2p3.fr/lavoisier/template.xsd">

<head tpl:include="/resource/app/html/header.html"></head>

<body class="hold-transition sidebar-mini ">
<div class="wrapper">
    <!-- Navbar -->
    <nav tpl:include="/resource/app/html/navbar.html"></nav>
    <!-- /.navbar -->

    <!-- Main Sidebar Container -->
    <aside tpl:include="/resource/app/html/sidebar.html"></aside>
    <!-- /sidebar -->

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <div class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-9">

                    </div><!-- /.col -->
                    <div class="col-sm-3">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="/">Home</a></li>

                        </ol>
                    </div><!-- /.col -->
                </div><!-- /.row -->
            </div><!-- /.container-fluid -->
        </div>
        <!-- /.content-header -->

        <!-- Main content -->
        <div class="content">
            <div class="container-fluid">
                <div class="row">


                    <div class="info-box m-2">
                        <span class="info-box-icon bg-info"><i class="far fa-id-card"></i></span>
                        <div class="info-box-content">
                            <span class="info-box-text">{{/root/@report}} Report</span>
                            <span class="info-box-number">{{count(/root/groups/group)}} groups</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>


                    <div class="info-box m-2" tpl:if="count(/root/groups/group[@status='OK'])&gt;0">
                        <span class="info-box-icon bg-OK"><i class="far fa-thumbs-up"></i></span>
                        <div class="info-box-content">
                            <a class="filter-status" id="status_OK" href="#OK"><span class="info-box-text">OK</span></a>
                            <span class="info-box-number">{{count(/root/groups/group[@status='OK'])}}</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>

                    <div class="info-box m-2" tpl:if="count(/root/groups/group[@status='CRITICAL'])&gt;0">
                        <span class="info-box-icon bg-CRITICAL"><i class="fas fa-times-circle"></i></span>
                        <div class="info-box-content">
                            <a class="filter-status" id="status_CRITICAL" href="#CRITICAL"><span class="info-box-text">CRITICAL</span></a>
                            <span class="info-box-number">{{count(/root/groups/group[@status='CRITICAL'])}}</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>

                    <div class="info-box m-2" tpl:if="count(/root/groups/group[@status='WARNING'])&gt;0">
                        <span class="info-box-icon bg-WARNING"><i class="fas fa-exclamation-triangle"></i></span>
                        <div class="info-box-content">
                            <a class="filter-status" id="status_WARNING" href="#WARNING"><span class="info-box-text">WARNING</span></a>
                            <span class="info-box-number">{{count(/root/groups/group[@status='WARNING'])}}</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>

                    <div class="info-box m-2" tpl:if="count(/root/groups/group[@status='DOWNTIME'])&gt;0">
                        <span class="info-box-icon bg-DOWNTIME"><i class="far fa-calendar-times"></i></span>
                        <div class="info-box-content">
                            <a class="filter-status" id="status_DOWNTIME" href="#DOWNTIME"><span class="info-box-text">DOWNTIME</span></a>

                            <span class="info-box-number">{{count(/root/groups/group[@status='DOWNTIME'])}}</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>

                    <div class="info-box m-2" tpl:if="count(/root/groups/group[@status='UNKNOWN'])&gt;0">
                        <span class="info-box-icon bg-UNKNOWN"><i class="fas fa-question-circle text-dark"></i></span>
                        <div class="info-box-content">
                            <a class="filter-status" id="status_UNKNOWN" href="#UNKNOWN"><span class="info-box-text">UNKNOWN</span></a>
                            <span class="info-box-number">{{count(/root/groups/group[@status='UNKNOWN'])}}</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>

                    <div class="info-box m-2" tpl:if="count(/root/groups/group[@status='MISSING'])&gt;0">

                        <span class="info-box-icon bg-MISSING"><i class="fas fa-unlink"></i></span>
                        <div class="info-box-content">
                            <a class="filter-status" id="status_MISSING" href="#MISSING"><span class="info-box-text">MISSING</span></a>
                            <span class="info-box-number">{{count(/root/groups/group[@status='MISSING'])}}</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                </div>
                <div class="row">
                    <div class="float-left">
                        <div class="input-group m-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-filter"><i class="m-1 fas fa-filter"></i></span>
                            </div>
                            <input type="text" class="form-control" placeholder="filter by site name" aria-label="filter" aria-describedby="basic-filter" onkeyup="filter(this)" />
                        </div>
                    </div>
                    <div class="ml-4">
                        <div class="input-group m-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="status-filter"><i class="m-1 fas fa-filter"></i></span>
                            </div>
                            <input type="text" id="input-status-filter" class="form-control" placeholder="filter by status" aria-label="filter" aria-describedby="basic-filter2" onkeyup="filterStatus(this)" />
                        </div>
                    </div>



                    <div class="float-right ml-auto m-2"><a class="mr-2 link" id="refreshPage"><i
                            class="fas fa-sync-alt"></i> </a>
                        <small>Last Refresh : {{/root/@lastRefresh}}</small>
                    </div>
                </div>


                <div tpl:foreach="/root/groups/group" class="row">
                    <div class="col-lg-12" id="group-status">

                        <div class="card">
                            <div class="card-header row">
                                <h4 class="card-title  col-3" rel="popover" id="h3_{@name}" title="{@name}">
                                    <div class="group">{{@name}}</div>
                                </h4>
                                    <div class="col-1 text-center">
                                        <span class="d-block status m-1 badge badge-{{status[not(following-sibling::status)]/@value}}">{{status[not(following-sibling::status)]/@value}}</span>
                                    </div>
                                    <div class="col-3 row">
                                        <div class="m-1" tpl:foreach="ar[last()]">
                                            <span tpl:if="@availability&gt;/root/@thresholdAv"
                                                  class="badge badge-success text-white text-bold">
                                               {{@availability}}
                                            </span>
                                                <span tpl:else="@availability&gt;=0"
                                                      class="badge badge-critical text-white text-bold">
                                               {{@availability}}
                                            </span>
                                                <span tpl:else="" class="badge badge-UNKNOWN">
                                              N.A
                                            </span>

                                        </div>
                                        <div class="m-1" tpl:foreach="ar[last()]">
                                            <span tpl:if="@reliability&gt;/root/@thresholdRe"
                                                  class="badge badge-success text-white text-bold">
                                               {{@reliability}}
                                            </span>
                                                <span tpl:else="@reliability&gt;=0"
                                                      class="badge badge-critical text-white text-bold">
                                               {{@reliability}}
                                            </span>
                                                <span tpl:else="" class="badge badge-UNKNOWN">
                                              N.A
                                            </span>

                                        </div>


                                    </div>

                                    <div class="ml-auto">
                                        <a  class="toggle-body" id="toggle_{{@name}}"> <i class="fas fa-angle-double-down text-primary"></i></a>
                                    </div>

                            </div>

                            <div class="card-body d-none" id="body-{{@name}}" >

                                <div class="row">
                                    <div class="col-1 small">Status</div>
                                    <svg id="svg-status" width="800px" height="40px">
                                        <g>
                                            <rect stroke-opacity="0.9" fill-opacity="0.6" stroke="{{@stroke}}"
                                                  rel="tooltip" tpl:foreach="status[@duration]" width="{{@duration}}"
                                                  height="20" x="{{@position}}" y="0" fill="{{@color}}"
                                                  title="{{@value}} status         From {{@timestamp}}     To {{following-sibling::status/@timestamp}}"/>
                                            <text x="0" y="35" font-family="Roboto" font-size="10" fill="black">
                                                {{status[@duration][1]/@timestamp}}
                                            </text>
                                            <text x="700" y="35" font-family="Roboto" font-size="10" fill="black">
                                                {{status[@duration][last()]/@timestamp}}
                                            </text>

                                        </g>
                                    </svg>

                                    <div class="ml-auto">
                                        <a  class="untoggle-body" id="untoggle_{{@name}}"> <i class="fas fa-angle-double-up text-primary"></i></a>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-1 small">Availability</div>
                                    <div tpl:foreach="ar" class="col-1">
                                        <div class="text-center">
                                            <span tpl:if="@availability&gt;/root/@thresholdAv"
                                                  class="badge badge-success text-white text-bold">
                                               {{@availability}}
                                            </span>
                                            <span tpl:else="@availability&gt;=0"
                                                  class="badge badge-critical text-white text-bold">
                                               {{@availability}}
                                            </span>
                                            <span tpl:else="" class="border border-dark badge badge-UNKNOWN">
                                              N.A
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-1 small"> </div>
                                    <div tpl:foreach="ar" class="col-1">
                                        <div class="text-center">
                                            <span class="small  text-muted">
                                               {{@timestamp}}
                                            </span>

                                        </div>
                                    </div>
                                </div>


                                <div class="row">
                                    <div class="col-1 small">Reliability</div>
                                    <div tpl:foreach="ar" class="col-1">
                                        <div class="text-center">
                                            <span tpl:if="@reliability&gt;/root/@thresholdRe"
                                                  class="badge badge-success text-white text-bold">
                                               {{@reliability}}
                                            </span>
                                            <span tpl:else="@reliability&gt;=0"
                                                  class="badge badge-critical text-white text-bold">
                                               {{@reliability}}
                                            </span>
                                            <span tpl:else="" class="badge badge-UNKNOWN">
                                              N.A
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            
                                </div>


                        </div>
                        <!-- /.card -->


                        <!-- /.card -->
                    </div>

                </div>
                <!-- /.row -->
            </div>
            <!-- /.container-fluid -->
        </div>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    <!-- Main Footer -->

    <footer tpl:include="/resource/app/html/footer.html"></footer>

</div>
<!-- ./wrapper -->

<!-- REQUIRED SCRIPTS -->

<!-- jQuery -->
<script src="/resource/app/html/adminlte/plugins/jquery/jquery.min.js?v={$app.version}"></script>
<!-- Bootstrap -->
<script src="/resource/app/html/adminlte/plugins/bootstrap/js/bootstrap.bundle.min.js?v={$app.version}"></script>
<!-- adminlte -->
<script src="/resource/app/html/adminlte/dist/js/adminlte.js?v={$app.version}"></script>


<!-- LOCAL SCRIPTS -->
<script src="/resource/app/js/status-ng.js?v={$app.version}"></script>


</body>
</html>

