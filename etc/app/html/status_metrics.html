<!DOCTYPE html>
<html lang="en" xmlns:tpl="http://software.in2p3.fr/lavoisier/template.xsd" xmlns:e="http://software.in2p3.fr/lavoisier/entries.xsd">

<head tpl:include="/resource/app/html/header.html"></head>

<body class="sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed" style="height: auto;" cz-shortcut-listen="true">
<div class="wrapper">
    <!-- Navbar -->
    <nav tpl:include="/resource/app/html/navbar.html"></nav>
    <!-- /.navbar -->

    <!-- Main Sidebar Container -->
    <aside tpl:include="/resource/app/html/sidebar.html"></aside>
    <!-- /sidebar -->

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <div class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-9">

                    </div><!-- /.col -->
                    <div class="col-sm-3">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="/">Home</a></li>
                            <li class="breadcrumb-item"><a href="/{root/@tenant}/{/root/@report}/metrics">Metrics</a></li>
                        </ol>
                    </div><!-- /.col -->
                </div><!-- /.row -->
            </div><!-- /.container-fluid -->
        </div>
        <!-- /.content-header -->

        <!-- Main content -->
        <div class="content">

            <div class="container-fluid" tpl:if="not(/root/@metrics)">
            <div class="row mb-3" >
                <div class="float-left">
                    <div class="title" ><h4><span class="badge badge-primary m-1 p-1">Select your metric</span></h4> </div><hr/>

                    <div class="input-group m-1">
                        <div class="input-group-prepend">
                            <span class="input-group-text" ><i class="m-1 fas fa-cog"></i></span>
                        </div>
                        <select id="metric" class="form-control">
                            <option>--Select a metric--</option>
                            <option tpl:foreach="/root/e:entries/e:entry" value="/{/root/@tenant}/{/root/@report}/metrics/{text()}">{{text()}}</option>
                        </select>

                    </div>
                </div>

            </div>
        </div>
            <div class="container-fluid" tpl:if="/root/@metrics!='_metrics_'">


                <div class="row">
                    <div class="info-box m-2 col-3">
                        <span class="info-box-icon bg-info"><i class="far fa-id-card"></i></span>
                        <div class="info-box-content">
                            <span class="info-box-text"><label class="mr-1">Report:</label>{{/root/@report}}</span>
                            <span class="info-box-text"><label class="mr-1">Metric:</label>{{/root/@metrics}}</span>

                            <span class="info-box-number">{{count(/root/metrics/group)}} groups - {{count(/root/metrics/group/metrics)}} checks</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>


                    <div class="info-box m-2 col-2" tpl:if="count(/root/metrics/group/metrics[@status='OK'])&gt;0">
                        <span class="info-box-icon bg-OK"><i class="far fa-thumbs-up"></i></span>
                        <div class="info-box-content">
                            <a class="filter-status" id="status_OK" href="#OK"><span class="info-box-text">OK</span></a>
                            <span class="info-box-number">{{count(/root/metrics/group/metrics[@status='OK'])}}</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>

                    <div class="info-box m-2 col-2" tpl:if="count(/root/metrics/group/metrics[@status='CRITICAL'])&gt;0">
                        <span class="info-box-icon bg-CRITICAL"><i class="fas fa-times-circle"></i></span>
                        <div class="info-box-content">
                            <a class="filter-status" id="status_CRITICAL" href="#CRITICAL"><span class="info-box-text">CRITICAL</span></a>
                            <span class="info-box-number">{{count(/root/metrics/group/metrics[@status='CRITICAL'])}}</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>

                    <div class="info-box m-2 col-2" tpl:if="count(/root/metrics/group/metrics[@status='WARNING'])&gt;0">
                        <span class="info-box-icon text-white bg-WARNING"><i class="fas fa-exclamation-triangle"></i></span>
                        <div class="info-box-content">
                            <a class="filter-status" id="status_WARNING" href="#WARNING"><span class="info-box-text">WARNING</span></a>
                            <span class="info-box-number">{{count(/root/metrics/group/metrics[@status='WARNING'])}}</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>

                    <div class="info-box m-2 col-2" tpl:if="count(/root/metrics/group/metrics[@status='DOWNTIME'])&gt;0">
                        <span class="info-box-icon bg-DOWNTIME"><i class="far fa-calendar-times"></i></span>
                        <div class="info-box-content">
                            <a class="filter-status" id="status_DOWNTIME" href="#DOWNTIME"><span class="info-box-text">DOWNTIME</span></a>

                            <span class="info-box-number">{{count(/root/metrics/group/metrics[@status='DOWNTIME'])}}</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>

                    <div class="info-box m-2 col-2" tpl:if="count(/root/metrics/group/metrics[@status='UNKNOWN'])&gt;0">
                        <span class="info-box-icon bg-UNKNOWN"><i class="fas fa-question-circle text-dark"></i></span>
                        <div class="info-box-content">
                            <a class="filter-status" id="status_UNKNOWN" href="#UNKNOWN"><span class="info-box-text">UNKNOWN</span></a>
                            <span class="info-box-number">{{count(/root/metrics/group/metrics[@status='UNKNOWN'])}}</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>

                    <div class="info-box m-2 col-2" tpl:if="count(/root/metrics/group/metrics[@status='MISSING'])&gt;0">

                        <span class="info-box-icon bg-MISSING"><i class="fas fa-unlink"></i></span>
                        <div class="info-box-content">
                            <a class="filter-status" id="status_MISSING" href="#MISSING"><span class="info-box-text">MISSING</span></a>
                            <span class="info-box-number">{{count(/root/metrics/group/metrics[@status='MISSING'])}}</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>


                </div>


                <div class="row mb-3" >
                    <div class="float-left">

                        <div class="input-group m-1">

                            <div class="input-group-prepend">
                                <span class="input-group-text" ><i class="m-1 fas fa-cog"></i></span>
                            </div>
                            <select id="metric" class="form-control">
                                <option tpl:if="/root/@metrics!='_metrics_'" value="/{{/root/@tenant}}/{{/root/@report}}/metrics/{{/root/@metrics}}" selected="true">{{/root/@metrics}}</option>
                                <option tpl:foreach="/root/e:entries/e:entry" value="/{{/root/@tenant}}/{{/root/@report}}/metrics/{{@name}}">{{@name}}</option>
                            </select>

                        </div>
                    </div>

                    <div class="mr-auto ml-1">

                            <div class="input-group m-1">

                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-filter"><i class="m-1 fas fa-filter"></i></span>
                                </div>
                                <input type="text" class="form-control" id="input-site-filter" placeholder="filter by group name" aria-label="filter" aria-describedby="basic-filter" onkeyup="filter(this)" />
                                <a class="erase" id="erase-input-site-filter"> <i class="fas fa-trash-alt m-1" /></a>


                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="status-filter"><i class="m-1 fas fa-filter"></i></span>
                                </div>
                                <input type="text" id="input-status-filter" class="form-control" placeholder="filter by status" aria-label="filter" aria-describedby="basic-filter2" onkeyup="filterStatus(this)" />
                                <a class="erase" id="erase-input-status-filter"> <i class="fas fa-trash-alt m-1" /></a>
                            </div>


                        </div>
                </div>


                <div tpl:foreach="/root/metrics/group"  class="row">
                        <div class="card col-12">
                        <div class="card-header row">

                                <div class="fas fa-home m-1"></div>
                                <div class="group col-3">{{@supergroup}}</div>

                                <div tpl:if="metrics/@status='CRITICAL'" class="status m-2 badge badge-CRITICAL">CRITICAL</div>
                                <div tpl:else="metrics/@status='WARNING'" class="status m-2 badge badge-WARNING">WARNING</div>
                                <div tpl:else="metrics/@status='MISSING'" class="status m-2 badge badge-MISSING">MISSING</div>
                                <div tpl:else="metrics/@status='UNKNOWN'" class="status m-2 badge badge-UNKNOWN">UNKNOWN</div>

                                <div tpl:else="metrics/@status='OK'" class="status m-2 badge badge-OK">OK</div>
                                <div tpl:else="" class="status badge badge-UNKNOWN m-2">UNKNOWN</div>



                            <div class="ml-auto">
                                <a  class="toggle-body" id="toggle_{{count(preceding-sibling::group)}}"> <i class="fas fa-angle-double-down text-primary"></i></a>
                            </div>

                            </div>




                        <div class="card-body d-none" id="body-{{count(preceding-sibling::group)}}" >

                            <div class="row">


                                <div class="ml-auto">
                                    <a  class="untoggle-body" id="untoggle_{{count(preceding-sibling::group)}}"> <i class="fas fa-angle-double-up text-primary"></i></a>
                                </div>
                            </div>
                            <div tpl:foreach="metrics">

                                <div class="row">
                                    <div class="col-3 m-1">{{@name}}</div>
                                    <div class="col-3 m-1">{{@service}}</div>
                                    <div class="col-2 m-1 small">{{@timestamp}}</div>
                                    <div class="col-2 badge badge-{{@status}} m-2">{{@status}}</div>
                                    <a href="#"><span  id="{{/root/@tenant}}_{{/root/@report}}_{{/root/@metrics}}_{{@name}}_{{@timestamp}}"   class="details fa fa-search-plus m-2"></span></a>
                                </div>

                                <div class="row d-none border-top border-bottom m-3" id="content_{{/root/@tenant}}_{{/root/@report}}_{{/root/@metrics}}_{{@name}}_{{@timestamp}}">
                                    <div><a href="#"><span  id="minus_{{/root/@tenant}}_{{/root/@report}}_{{/root/@metrics}}_{{@name}}_{{@timestamp}}"   class="m-details m-2 fa fa-search-minus"></span></a></div>
                                </div>


                            </div>



                        </div>
                        </div>
                    </div>


            </div>


        </div>
        <!-- /.content -->
    </div>

    <!-- /.content-wrapper -->
    <!-- Main Footer -->

    <footer tpl:include="/resource/app/html/footer.html"></footer>

</div>
<!-- ./wrapper -->

<!-- REQUIRED SCRIPTS -->

<!-- jQuery -->
<script src="/resource/app/html/adminlte/plugins/jquery/jquery.min.js?v={$app.version}"></script>
<!-- Bootstrap -->
<script src="/resource/app/html/adminlte/plugins/bootstrap/js/bootstrap.bundle.min.js?v={$app.version}"></script>
<!-- adminlte -->
<script src="/resource/app/html/adminlte/dist/js/adminlte2.min.js?v={$app.version}"></script>



<!-- LOCAL SCRIPTS -->
<script src="/resource/app/js/status-metrics.js?v={$app.version}"></script>




</body>
</html>

